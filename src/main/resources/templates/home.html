<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <script type="text/javascript" src="../../js/jquery-2.1.1.js"></script> 
        <script src="http://malsup.github.com/jquery.form.js"></script> 
        <script src="../../js/bootstrap.min.js"></script>
        <link href="../../css/bootstrap-theme.css" rel="stylesheet" />
        <link href="../../css/bootstrap.min.css" rel="stylesheet" />

        <title>Note project</title>
        <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.min.js"></script>
    </head>

    <body ng-app="noteApp">
        <div th:switch="${#authentication}? ${#authorization.expression('isAuthenticated()')} : ${false}">
            <span th:case="${false}">User is not logged, please Click <a th:href="@{/login}">here</a> to sign.</span>
            <span th:case="${true}">Logged</span>
        </div>
        <div th:if="${#authentication}? ${#authorization.expression('isAuthenticated()')} : ${true}">       
            <form th:action="@{/logout}" method="post">
                <input type="submit" value="Sign Out"/>
            </form>
        </div>

        <div class="container-fluid" ng-controller="noteController">
            <div class="row-fluid">
                <div class="span9">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Title</th>
                                <th>Description First</th>
                                <th>Image</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="item in items">
                                <td>{{item.id}}</td>
                                <td>{{item.title}}</td>
                                <td>{{item.description}}</td>
                                <td><img ng-src='/uploads/{{item.picture}}' alt="image" height="42" width="42" /></td>
                                <td sec:authorize="hasRole('ROLE_ADMIN')"><button type="button" data-itemid='{{item.id}}' ng-click='delete(item.id)'>Remove</button></td>
                                <td sec:authorize="hasRole('ROLE_ADMIN')"><button type="button" data-itemid='{{item.id}}' ng-click='edit(item.id)'>Edit</button></td>
                            </tr>

                        </tbody>
                    </table>
                    <button type="button" ng-click="add()">Add</button>
                    <form id="noteEditForm" ng-show="visible">
                        <input type="hidden" name="id" ng-model="newitem.id" />
                        <input name="title" ng-model="newitem.title" />
                        <input name="description" ng-model="newitem.description" />
                        <input type="file" name="pictureFile" ng-model="newitem.picture" file-model="myFile" />
                        
                        <button value="save" ng-click="saveItem()">Save</button>
                    </form>
                </div>
            </div>
        </div>

        <div th:include="footer :: copy"></div>

        
        <script src="../../js/app.js"></script>
        <script src="../../js/controller.js"></script>
        <script>//<![CDATA[
////            
//                            var saveNewItem = function () {
//                                $("#noteEditForm").ajaxForm({
//                                    method: "POST",
//                                    url: "note/save",
//                                    success: function (item, status) {
//                                        if (status = "success") {
//                                            console.log(item);
//                                        }
//                                    }
//                                })
//                            };
////           
//                            //]]></script>

    </body>
</html>